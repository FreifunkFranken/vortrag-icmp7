\section{Gateway}

%Über die Gateways steht i.d.R. auch eine Internetverbindung zur
%Verfügung. Auch die Installation dieser Gateways sollen daher Teil
%des Vortrags sein.

\begin{frame}{Gateway}
    \begin{block}{Aktueller Zustand}
        \begin{itemize}
            \item Gateway in Rumänien
            \begin{itemize}
                \item[$\rightarrow$] Direkt Internet
            \end{itemize}
            \item Gateway in Nürnberg
            \begin{itemize}
                \item[$\rightarrow$] OpenVPN über Berlin
            \end{itemize}
        \end{itemize}
    \end{block}

    $\longrightarrow$ Das Beispiel hier stammt vom Gateway in Nürnberg
\end{frame}

\begin{frame}{Gateway}
    \begin{block}{Voraussetzungen}
        \begin{itemize}
            \item Server (kein Spielzeug; also kein Pi)
            \item Richtiges Betriebssystem (z.B. ein Debian)
            \item Policy Based Routing
            \item DHCP- DNS-Server
            \item batman + fastd (fff\_fuerth\_fastd.sh)
            \item Lokale Netz Konfiguration
            \item Freifunk-VPN (z.B. ip-ip)
            \item olsr
            \item Ein Tunnel um Traffic ab zu werfen\\
        \end{itemize}
    \end{block}
\end{frame}

\begin{frame}[fragile]{Gateway}
    \begin{block}{Policy Based Routing}
        \begin{lstlisting}
- iproute2
/etc/iproute2/rt_tables:
10 fff
        \end{lstlisting}
    \end{block}
\end{frame}

\begin{frame}[fragile]{Gateway}
    \begin{block}{DHCP-Server}
        \begin{lstlisting}
/etc/default/isc-dhcp-server:
INTERFACES="bat1"

/etc/dhcp/dhcpd.conf
option domain-name "freifunk-franken.de";
option domain-name-servers 10.50.16.1;
authoritative;
# fuerth
subnet 10.50.32.0 netmask 255.255.248.0 {
  range 10.50.35.0 10.50.36.255;
  option routers 10.50.32.2;
  option domain-name-servers 10.50.32.2;
}
        \end{lstlisting}
    \end{block}
\end{frame}

\begin{frame}[fragile]{Gateway}
    \begin{block}{DNS}
        \begin{lstlisting}
- dns
bind installieren
/etc/bind/named.conf.options:
       //listen-on-v6 { any; };
       allow-recursion { 10.50.0.0/16; };
        \end{lstlisting}
    \end{block}
\end{frame}


\begin{frame}[fragile]{Gateway}
    \begin{block}{B.A.T.M.A.N}
        \begin{lstlisting}
batman-adv-2013.4.0
batctl-2013.4.0

/etc/modules:
batman-adv
        \end{lstlisting}
    \end{block}
\end{frame}

\begin{frame}[fragile]{Gateway}
    \begin{block}{fastd}
        \begin{lstlisting}
- fastd
-- fastd init scripte deaktivieren:
/etc/default/fastd:
AUTOSTART="none"

- fff_fuerth_fastd.sh
        \end{lstlisting}
    \end{block}
\end{frame}

\begin{frame}[fragile]{Gateway}
    \begin{block}{Lokale Netz Konfiguration}
        \begin{lstlisting}
/etc/network/interfaces:
auto ffffuerthVPN
iface ffffuerthVPN inet manual
    post-up /usr/local/sbin/batctl -m bat1 if add $IFACE
    post-up ifconfig $IFACE up
    post-up ifup bat1
    post-down ifdown bat1
    post-down ifconfig $IFACE down

auto bat1
iface bat1 inet manual
    post-up ifconfig $IFACE up
    post-up ip addr add 10.50.32.2/21 dev $IFACE
    post-up ip rule add iif $IFACE table fff
    post-up ip rule add from 10.50.32.0/21 table fff
    post-up ip rule add to 10.50.32.0/21 table fff
    post-up ip route add 10.50.32.0/21 dev $IFACE table fff
    post-up invoke-rc.d isc-dhcp-server restart
    post-down ip route del 10.50.32.0/21 dev $IFACE table fff
    post-down ip rule del from 10.50.32.0/21 table fff
    post-down ip rule del to 10.50.32.0/21 table fff
    post-down ip rule del iif $IFACE table fff
    post-down ifconfig $IFACE down
        \end{lstlisting}
    \end{block}
\end{frame}

\begin{frame}[fragile]{Gateway}
    \begin{block}{IP IP Tunndel}
        \begin{lstlisting}
- ip ip tunnel
/etc/network/interfaces:
auto ro1
iface ro1 inet static
    address 192.168.230.2
    pre-up iptunnel add ro1 mode gre local 193.192.41.129 remote 109.163.229.254 ttl 255
    up ifconfig ro1 multicast
    pointopoint 192.168.230.1
    post-down iptunnel del ro1
        \end{lstlisting}
    \end{block}
\end{frame}

\begin{frame}[fragile]{Gateway}
    \begin{block}{olsr}
        \begin{lstlisting}
- olsrd 0.6.2-2.1
/etc/olsrd/olsrd.conf:
Interface "ro1"
{
    Ip4Broadcast 255.255.255.255
    LinkQualityMult 192.168.230.2 0.5
}

Hna4
{
    10.50.32.0 255.255.248.0
}

LoadPlugin "olsrd_httpinfo.so.0.1"
{
       PlParam "Port" "8080"
       PlParam "Net" "0.0.0.0 0.0.0.0"
}

RtProto 8
RtTable 10
RtTableDefault 10
RtTableTunnel 10
        \end{lstlisting}
    \end{block}
\end{frame}

